# ListPool
ListPool is an allocation free implementation of IList using ArrayPool.

## Benchmarks.

BenchmarkDotNet=v0.12.0, OS=Windows 10.0.18362
Intel Core i7-8750H CPU 2.20GHz (Coffee Lake), 1 CPU, 12 logical and 6 physical cores
.NET Core SDK=3.1.100
  [Host]     : .NET Core 3.1.0 (CoreCLR 4.700.19.56402, CoreFX 4.700.19.56404), X64 RyuJIT
  Job-UIKAVW : .NET Core 3.1.0 (CoreCLR 4.700.19.56402, CoreFX 4.700.19.56404), X64 RyuJIT

Concurrent=True  Server=True  

### Create list

```
|   Method |     N |        Mean |     Error |    StdDev | Ratio | RatioSD | Rank |  Gen 0 |  Gen 1 | Gen 2 | Allocated |
|--------- |------ |------------:|----------:|----------:|------:|--------:|-----:|-------:|-------:|------:|----------:|
|     List |    10 |    14.07 ns |  0.355 ns |  0.332 ns |  1.00 |    0.00 |    1 | 0.0014 |      - |     - |      96 B |
| ListPool |    10 |    26.24 ns |  0.097 ns |  0.091 ns |  1.87 |    0.04 |    2 |      - |      - |     - |         - |
|          |       |             |           |           |       |         |      |        |        |       |           |
| ListPool |   100 |    25.66 ns |  0.087 ns |  0.081 ns |  0.58 |    0.00 |    1 |      - |      - |     - |         - |
|     List |   100 |    44.01 ns |  0.297 ns |  0.278 ns |  1.00 |    0.00 |    2 | 0.0068 |      - |     - |     456 B |
|          |       |             |           |           |       |         |      |        |        |       |           |
| ListPool |  1000 |    25.46 ns |  0.110 ns |  0.097 ns |  0.07 |    0.00 |    1 |      - |      - |     - |         - |
|     List |  1000 |   352.93 ns |  3.727 ns |  3.112 ns |  1.00 |    0.00 |    2 | 0.0610 |      - |     - |    4056 B |
|          |       |             |           |           |       |         |      |        |        |       |           |
| ListPool | 10000 |    30.44 ns |  0.311 ns |  0.291 ns |  0.01 |    0.00 |    1 |      - |      - |     - |         - |
|     List | 10000 | 2,796.47 ns | 14.119 ns | 13.207 ns |  1.00 |    0.00 |    2 | 0.7248 | 0.0229 |     - |   40056 B |
```

### Insert items

```
|   Method |    N |        Mean |     Error |    StdDev |        Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |------------:|----------:|----------:|--------------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool |   10 |    29.27 ns |  20.94 ns |  55.53 ns |     0.0000 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List |   10 |   129.27 ns |  32.18 ns |  85.33 ns |   100.0000 ns |     ? |       ? |    2 |     - |     - |     - |         - |
|          |      |             |           |           |               |       |         |      |       |       |       |           |
| ListPool |  100 |   370.00 ns |  50.86 ns | 141.78 ns |   300.0000 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List |  100 |   962.00 ns | 331.00 ns | 975.95 ns |   450.0000 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|          |      |             |           |           |               |       |         |      |       |       |       |           |
| ListPool | 1000 | 2,473.96 ns | 172.33 ns | 497.20 ns | 2,300.0000 ns |  0.99 |    0.31 |    1 |     - |     - |     - |         - |
|     List | 1000 | 2,640.22 ns | 236.06 ns | 665.82 ns | 2,400.0000 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
```

### Enumerate with foreach

```
|   Method |    N | CapacityFilled |        Mean |     Error |    StdDev |        Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |--------------- |------------:|----------:|----------:|--------------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool | 1000 |            0,1 |    39.76 ns |  21.85 ns |  58.31 ns |     0.0000 ns |  0.08 |    0.11 |    1 |     - |     - |     - |         - |
|     List | 1000 |            0,1 |   580.46 ns |  49.78 ns | 136.26 ns |   600.0000 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |      |                |             |           |           |               |       |         |      |       |       |       |           |
| ListPool | 1000 |            0,5 |   340.23 ns |  23.28 ns |  63.72 ns |   300.0000 ns |  0.15 |    0.04 |    1 |     - |     - |     - |         - |
|     List | 1000 |            0,5 | 2,453.19 ns | 263.63 ns | 752.16 ns | 2,250.0000 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |      |                |             |           |           |               |       |         |      |       |       |       |           |
| ListPool | 1000 |            0,8 |   490.32 ns |  28.97 ns |  82.18 ns |   500.0000 ns |  0.17 |    0.04 |    1 |     - |     - |     - |         - |
|     List | 1000 |            0,8 | 3,013.19 ns | 208.43 ns | 584.47 ns | 2,800.0000 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |      |                |             |           |           |               |       |         |      |       |       |       |           |
| ListPool | 1000 |              1 |   556.45 ns |  37.05 ns | 105.09 ns |   550.0000 ns |  0.16 |    0.04 |    1 |     - |     - |     - |         - |
|     List | 1000 |              1 | 3,550.00 ns | 227.41 ns | 641.43 ns | 3,350.0000 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
```

### Array.ToList()

```
|   Method |    N | CapacityFilled |      Mean |    Error |   StdDev | Ratio | Rank |  Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |--------------- |----------:|---------:|---------:|------:|-----:|-------:|------:|------:|----------:|
|     List |   10 |              1 |  48.62 ns | 0.219 ns | 0.205 ns |  1.00 |    1 | 0.0014 |     - |     - |      96 B |
| ListPool |   10 |              1 |  59.17 ns | 0.340 ns | 0.284 ns |  1.22 |    2 |      - |     - |     - |         - |
|          |      |                |           |          |          |       |      |        |       |       |           |
| ListPool |   50 |              1 |  71.18 ns | 0.379 ns | 0.317 ns |  0.99 |    1 |      - |     - |     - |         - |
|     List |   50 |              1 |  72.03 ns | 0.346 ns | 0.324 ns |  1.00 |    1 | 0.0038 |     - |     - |     256 B |
|          |      |                |           |          |          |       |      |        |       |       |           |
| ListPool |  100 |              1 |  71.05 ns | 0.221 ns | 0.196 ns |  0.78 |    1 |      - |     - |     - |         - |
|     List |  100 |              1 |  91.59 ns | 0.321 ns | 0.285 ns |  1.00 |    2 | 0.0068 |     - |     - |     456 B |
|          |      |                |           |          |          |       |      |        |       |       |           |
| ListPool | 1000 |              1 | 128.38 ns | 2.465 ns | 2.637 ns |  0.29 |    1 |      - |     - |     - |         - |
|     List | 1000 |              1 | 446.56 ns | 2.449 ns | 2.291 ns |  1.00 |    2 | 0.0606 |     - |     - |    4056 B |
```

### IEnumerable.ToList()

```
|   Method |    N |      Mean |     Error |    StdDev |    Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |----------:|----------:|----------:|----------:|------:|--------:|-----:|------:|------:|------:|----------:|
|     List |   10 |  2.310 us | 0.2555 us | 0.6950 us |  2.200 us |  1.00 |    0.00 |    1 |     - |     - |     - |      96 B |
| ListPool |   10 |  2.451 us | 0.2021 us | 0.5798 us |  2.400 us |  1.14 |    0.42 |    1 |     - |     - |     - |         - |
|          |      |           |           |           |           |       |         |      |       |       |       |           |
|     List |   50 |  2.389 us | 0.2570 us | 0.7207 us |  2.200 us |  1.00 |    0.00 |    1 |     - |     - |     - |     256 B |
| ListPool |   50 |  2.790 us | 0.2474 us | 0.6815 us |  2.500 us |  1.28 |    0.48 |    2 |     - |     - |     - |         - |
|          |      |           |           |           |           |       |         |      |       |       |       |           |
|     List |  100 |  2.550 us | 0.2395 us | 0.6676 us |  2.300 us |  1.00 |    0.00 |    1 |     - |     - |     - |     456 B |
| ListPool |  100 |  3.523 us | 0.2416 us | 0.6776 us |  3.300 us |  1.47 |    0.45 |    2 |     - |     - |     - |         - |
|          |      |           |           |           |           |       |         |      |       |       |       |           |
|     List | 1000 |  5.519 us | 0.2500 us | 0.6673 us |  5.200 us |  1.00 |    0.00 |    1 |     - |     - |     - |    4056 B |
| ListPool | 1000 | 15.861 us | 1.3985 us | 4.0349 us | 14.400 us |  2.86 |    0.80 |    2 |     - |     - |     - |         - |
```

### Clear

```
|   Method |    N | CapacityFilled |       Mean |     Error |     StdDev |      Median |      P95 | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |--------------- |-----------:|----------:|-----------:|------------:|---------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool | 1000 |            0,1 |  91.111 ns | 41.878 ns | 116.739 ns | 100.0000 ns | 300.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List | 1000 |            0,1 | 280.460 ns | 55.663 ns | 152.376 ns | 200.0000 ns | 570.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
|          |      |                |            |           |            |             |          |       |         |      |       |       |       |           |
| ListPool | 1000 |            0,5 |  62.360 ns | 32.675 ns |  90.542 ns |   0.0000 ns | 250.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List | 1000 |            0,5 | 229.348 ns | 74.803 ns | 210.983 ns | 200.0000 ns | 700.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
|          |      |                |            |           |            |             |          |       |         |      |       |       |       |           |
| ListPool | 1000 |            0,8 |   8.235 ns | 10.228 ns |  27.653 ns |   0.0000 ns | 100.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List | 1000 |            0,8 |  89.888 ns | 47.130 ns | 130.597 ns |   0.0000 ns | 400.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|          |      |                |            |           |            |             |          |       |         |      |       |       |       |           |
| ListPool | 1000 |              1 |  41.935 ns | 22.247 ns |  63.112 ns |   0.0000 ns | 200.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List | 1000 |              1 | 136.782 ns | 37.830 ns | 103.559 ns | 100.0000 ns | 300.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
```
