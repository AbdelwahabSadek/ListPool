# ListPool
ListPool, allocation free implementation of IList.

This is a POC of a wrapper over ArrayPool<T> which implements IList or ICollection, still not sure which is the best approach. But main idea is to reduce the complecity of using ArrayPool.

I recommend using similiar approach when working with large arrays. At least bigger than 100 items.

# Benchmarks.

BenchmarkDotNet=v0.12.0, OS=Windows 10.0.18362
Intel Core i7-8750H CPU 2.20GHz (Coffee Lake), 1 CPU, 12 logical and 6 physical cores
.NET Core SDK=3.1.100
  [Host]     : .NET Core 3.1.0 (CoreCLR 4.700.19.56402, CoreFX 4.700.19.56404), X64 RyuJIT
  Job-UIKAVW : .NET Core 3.1.0 (CoreCLR 4.700.19.56402, CoreFX 4.700.19.56404), X64 RyuJIT

Concurrent=True  Server=True  

## Create list


```
|   Method |     N |        Mean |      Error |     StdDev |      Median | Ratio | RatioSD | Rank |  Gen 0 |  Gen 1 | Gen 2 | Allocated |
|--------- |------ |------------:|-----------:|-----------:|------------:|------:|--------:|-----:|-------:|-------:|------:|----------:|
|     List |    10 |    21.14 ns |   0.454 ns |   0.906 ns |    21.13 ns |  1.00 |    0.00 |    1 | 0.0063 |      - |     - |      96 B |
| ListPool |    10 |    33.41 ns |   0.384 ns |   0.359 ns |    33.34 ns |  1.56 |    0.08 |    2 |      - |      - |     - |         - |
|          |       |             |            |            |             |       |         |      |        |        |       |           |
| ListPool |   100 |    32.00 ns |   0.204 ns |   0.191 ns |    32.01 ns |  0.42 |    0.06 |    1 |      - |      - |     - |         - |
|     List |   100 |    71.35 ns |   2.682 ns |   7.477 ns |    68.70 ns |  1.00 |    0.00 |    2 | 0.0300 |      - |     - |     456 B |
|          |       |             |            |            |             |       |         |      |        |        |       |           |
| ListPool |  1000 |    32.12 ns |   0.332 ns |   0.310 ns |    32.10 ns |  0.06 |    0.00 |    1 |      - |      - |     - |         - |
|     List |  1000 |   578.14 ns |  15.554 ns |  45.126 ns |   568.04 ns |  1.00 |    0.00 |    2 | 0.2680 | 0.0010 |     - |    4056 B |
|          |       |             |            |            |             |       |         |      |        |        |       |           |
| ListPool | 10000 |    32.68 ns |   0.684 ns |   0.913 ns |    32.27 ns | 0.007 |    0.00 |    1 |      - |      - |     - |         - |
|     List | 10000 | 4,850.08 ns | 136.170 ns | 392.882 ns | 4,792.80 ns | 1.000 |    0.00 |    2 | 2.6550 | 0.1678 |     - |   40056 B |
```

## Create and add items

```
|   Method |     N |         Mean |      Error |     StdDev | Ratio | RatioSD | Rank |  Gen 0 |  Gen 1 | Gen 2 | Allocated |
|--------- |------ |-------------:|-----------:|-----------:|------:|--------:|-----:|-------:|-------:|------:|----------:|
|     List |    10 |     39.35 ns |   0.820 ns |   1.202 ns |  1.00 |    0.00 |    1 | 0.0063 |      - |     - |      96 B |
| ListPool |    10 |     61.47 ns |   0.663 ns |   0.553 ns |  1.55 |    0.04 |    2 |      - |      - |     - |         - |
|          |       |              |            |            |       |         |      |        |        |       |           |
| ListPool |   100 |    267.40 ns |   1.555 ns |   1.455 ns |  0.98 |    0.02 |    1 |      - |      - |     - |         - |
|     List |   100 |    271.89 ns |   5.837 ns |   6.246 ns |  1.00 |    0.00 |    1 | 0.0300 |      - |     - |     456 B |
|          |       |              |            |            |       |         |      |        |        |       |           |
| ListPool |  1000 |  2,179.37 ns |  16.996 ns |  15.898 ns |  0.84 |    0.03 |    1 |      - |      - |     - |         - |
|     List |  1000 |  2,580.91 ns |  51.303 ns |  78.346 ns |  1.00 |    0.00 |    2 | 0.2670 |      - |     - |    4056 B |
|          |       |              |            |            |       |         |      |        |        |       |           |
| ListPool | 10000 | 21,597.68 ns | 155.178 ns | 145.153 ns |  0.87 |    0.01 |    1 |      - |      - |     - |         - |
|     List | 10000 | 24,848.87 ns | 358.520 ns | 335.360 ns |  1.00 |    0.00 |    2 | 2.6550 | 0.1526 |     - |   40056 B |
```

## Enumerate with foreach

```
|   Method |    N | CapacityFilled |       Mean |    Error |    StdDev |     Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |--------------- |-----------:|---------:|----------:|-----------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool | 1000 |            0.1 |   289.7 ns | 46.95 ns | 128.53 ns |   300.0 ns |  0.41 |    0.19 |    1 |     - |     - |     - |         - |
|     List | 1000 |            0.1 |   741.8 ns | 74.25 ns | 208.20 ns |   700.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |      |                |            |          |           |            |       |         |      |       |       |       |           |
| ListPool | 1000 |            0.5 |   259.6 ns | 29.16 ns |  80.79 ns |   300.0 ns |  0.17 |    0.06 |    1 |     - |     - |     - |         - |
|     List | 1000 |            0.5 | 1,591.4 ns | 89.06 ns | 252.66 ns | 1,500.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |      |                |            |          |           |            |       |         |      |       |       |       |           |
| ListPool | 1000 |            0.8 |   314.1 ns | 34.30 ns |  96.74 ns |   300.0 ns |  0.14 |    0.05 |    1 |     - |     - |     - |         - |
|     List | 1000 |            0.8 | 2,146.9 ns | 48.90 ns |  76.13 ns | 2,100.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |      |                |            |          |           |            |       |         |      |       |       |       |           |
| ListPool | 1000 |              1 |   486.6 ns | 57.07 ns | 151.34 ns |   500.0 ns |  0.18 |    0.05 |    1 |     - |     - |     - |         - |
|     List | 1000 |              1 | 2,730.4 ns | 64.81 ns | 156.53 ns | 2,700.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |

```

## Array to List and ListPool

```
|   Method |    N | CapacityFilled |      Mean |     Error |    StdDev | Ratio | RatioSD | Rank |  Gen 0 |  Gen 1 | Gen 2 | Allocated |
|--------- |----- |--------------- |----------:|----------:|----------:|------:|--------:|-----:|-------:|-------:|------:|----------:|
|     List |   10 |              1 |  64.22 ns |  1.302 ns |  1.692 ns |  1.00 |    0.00 |    1 | 0.0063 |      - |     - |      96 B |
| ListPool |   10 |              1 |  70.61 ns |  0.550 ns |  0.515 ns |  1.10 |    0.03 |    2 |      - |      - |     - |         - |
|          |      |                |           |           |           |       |         |      |        |        |       |           |
| ListPool |   50 |              1 |  84.20 ns |  0.772 ns |  0.722 ns |  0.80 |    0.04 |    1 |      - |      - |     - |         - |
|     List |   50 |              1 | 101.57 ns |  2.049 ns |  5.362 ns |  1.00 |    0.00 |    2 | 0.0169 |      - |     - |     256 B |
|          |      |                |           |           |           |       |         |      |        |        |       |           |
| ListPool |  100 |              1 |  84.73 ns |  0.690 ns |  0.645 ns |  0.66 |    0.02 |    1 |      - |      - |     - |         - |
|     List |  100 |              1 | 128.07 ns |  2.503 ns |  3.166 ns |  1.00 |    0.00 |    2 | 0.0303 |      - |     - |     456 B |
|          |      |                |           |           |           |       |         |      |        |        |       |           |
| ListPool | 1000 |              1 | 121.38 ns |  0.901 ns |  0.799 ns |  0.17 |    0.01 |    1 |      - |      - |     - |         - |
|     List | 1000 |              1 | 759.24 ns | 18.971 ns | 55.936 ns |  1.00 |    0.00 |    2 | 0.2689 | 0.0010 |     - |    4056 B |

## Add

```
|   Method |    N |       Mean |     Error |    StdDev |     Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |----- |-----------:|----------:|----------:|-----------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool |   10 |   134.1 ns |  61.64 ns | 163.47 ns |   100.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List |   10 |   231.8 ns |  58.54 ns | 158.27 ns |   200.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
|          |      |            |           |           |            |       |         |      |       |       |       |           |
|     List |  100 |   261.2 ns |  28.59 ns |  77.30 ns |   300.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |  100 |   448.4 ns |  30.45 ns |  87.35 ns |   400.0 ns |  1.95 |    0.95 |    2 |     - |     - |     - |         - |
|          |      |            |           |           |            |       |         |      |       |       |       |           |
| ListPool | 1000 | 2,443.3 ns |  63.46 ns |  59.36 ns | 2,450.0 ns |  1.12 |    0.15 |    1 |     - |     - |     - |         - |
|     List | 1000 | 2,574.2 ns | 240.27 ns | 697.06 ns | 2,200.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
```

## Clear

```
|   Method |     N |        Mean |     Error |      StdDev |   Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |------------:|----------:|------------:|---------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool |    10 |    61.63 ns |  22.67 ns |    61.68 ns | 100.0 ns |  0.14 |    0.21 |    1 |     - |     - |     - |         - |
|     List |    10 | 1,393.81 ns | 596.47 ns | 1,730.48 ns | 400.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |       |             |           |             |          |       |         |      |       |       |       |           |
| ListPool |   100 |    71.95 ns |  17.04 ns |    45.20 ns | 100.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List |   100 |   331.76 ns |  81.76 ns |   221.04 ns | 300.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
|          |       |             |           |             |          |       |         |      |       |       |       |           |
| ListPool |  1000 |    96.47 ns |  27.64 ns |    74.72 ns | 100.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List |  1000 |   322.78 ns |  77.92 ns |   202.52 ns | 300.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
|          |       |             |           |             |          |       |         |      |       |       |       |           |
| ListPool | 10000 |    71.08 ns |  23.06 ns |    61.55 ns | 100.0 ns |     ? |       ? |    1 |     - |     - |     - |         - |
|     List | 10000 |   189.20 ns |  29.32 ns |    80.75 ns | 150.0 ns |     ? |       ? |    2 |     - |     - |     - |         - |
```

## Contains

```
|   Method |     N |       Mean |    Error |     StdDev |     Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |-----------:|---------:|-----------:|-----------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool |    10 |   946.0 ns | 152.7 ns |   450.2 ns |   800.0 ns |  0.88 |    0.68 |    1 |     - |     - |     - |         - |
|     List |    10 | 1,441.6 ns | 310.0 ns |   859.0 ns | 1,100.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |       |            |          |            |            |       |         |      |       |       |       |           |
|     List |   100 |   988.6 ns | 144.7 ns |   386.3 ns |   850.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |   100 | 1,064.9 ns | 132.1 ns |   376.9 ns |   900.0 ns |  1.25 |    0.58 |    2 |     - |     - |     - |         - |
|          |       |            |          |            |            |       |         |      |       |       |       |           |
| ListPool |  1000 | 1,703.3 ns | 147.0 ns |   412.2 ns | 1,600.0 ns |  0.83 |    0.30 |    1 |     - |     - |     - |         - |
|     List |  1000 | 2,220.0 ns | 254.8 ns |   710.3 ns | 2,100.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |       |            |          |            |            |       |         |      |       |       |       |           |
| ListPool | 10000 | 8,200.0 ns | 612.9 ns | 1,677.7 ns | 7,400.0 ns |  1.01 |    0.26 |    1 |     - |     - |     - |         - |
|     List | 10000 | 8,524.7 ns | 792.7 ns | 2,196.7 ns | 7,600.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
```

## CopyTo

```
|   Method |     N |       Mean |     Error |     StdDev |     Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |-----------:|----------:|-----------:|-----------:|------:|--------:|-----:|------:|------:|------:|----------:|
|     List |    10 |   710.1 ns | 134.50 ns |   349.6 ns |   600.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |    10 |   716.1 ns | 126.04 ns |   345.0 ns |   600.0 ns |  1.20 |    0.68 |    1 |     - |     - |     - |         - |
|          |       |            |           |            |            |       |         |      |       |       |       |           |
|     List |   100 |   698.8 ns | 102.77 ns |   274.3 ns |   600.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |   100 | 2,233.3 ns | 899.93 ns | 2,639.3 ns |   800.0 ns |  2.68 |    4.21 |    1 |     - |     - |     - |         - |
|          |       |            |           |            |            |       |         |      |       |       |       |           |
|     List |  1000 |   854.9 ns |  63.63 ns |   178.4 ns |   800.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |  1000 | 1,043.5 ns | 146.40 ns |   412.9 ns |   850.0 ns |  1.27 |    0.56 |    2 |     - |     - |     - |         - |
|          |       |            |           |            |            |       |         |      |       |       |       |           |
|     List | 10000 | 3,019.0 ns | 170.38 ns |   457.7 ns | 2,950.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool | 10000 | 3,164.0 ns | 192.54 ns |   523.8 ns | 3,050.0 ns |  1.07 |    0.22 |    2 |     - |     - |     - |         - |
```

## IndexOf

```
|   Method |     N |     Mean |     Error |    StdDev |    Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |---------:|----------:|----------:|----------:|------:|--------:|-----:|------:|------:|------:|----------:|
|     List |    10 | 1.184 us | 0.1772 us | 0.5142 us | 1.1500 us |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |    10 | 1.357 us | 0.3080 us | 0.8433 us | 1.1000 us |  1.32 |    0.94 |    1 |     - |     - |     - |         - |
|          |       |          |           |           |           |       |         |      |       |       |       |           |
| ListPool |   100 | 1.002 us | 0.1282 us | 0.3657 us | 0.9000 us |  0.93 |    0.49 |    1 |     - |     - |     - |         - |
|     List |   100 | 1.267 us | 0.1868 us | 0.5389 us | 1.0500 us |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |       |          |           |           |           |       |         |      |       |       |       |           |
| ListPool |  1000 | 1.498 us | 0.1757 us | 0.4779 us | 1.2500 us |  0.84 |    0.44 |    1 |     - |     - |     - |         - |
|     List |  1000 | 2.149 us | 0.3981 us | 1.1096 us | 1.8000 us |  1.00 |    0.00 |    2 |     - |     - |     - |         - |
|          |       |          |           |           |           |       |         |      |       |       |       |           |
|     List | 10000 | 8.242 us | 0.6603 us | 1.8077 us | 7.4500 us |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool | 10000 | 8.572 us | 0.7960 us | 2.1924 us | 7.7500 us |  1.08 |    0.32 |    1 |     - |     - |     - |         - |
```

## Insert

```
|   Method |     N |        Mean |       Error |     StdDev |      Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |------------:|------------:|-----------:|------------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool |    10 |    839.4 ns |    86.50 ns |   246.8 ns |    800.0 ns |  0.23 |    0.14 |    1 |     - |     - |     - |         - |
|     List |    10 |  5,177.9 ns | 1,215.01 ns | 3,486.1 ns |  3,800.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |     104 B |
|          |       |             |             |            |             |       |         |      |       |       |       |           |
| ListPool |   100 |  1,030.5 ns |   119.34 ns |   342.4 ns |    900.0 ns |  0.31 |    0.15 |    1 |     - |     - |     - |         - |
|     List |   100 |  3,910.5 ns |   634.23 ns | 1,725.5 ns |  3,450.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |     824 B |
|          |       |             |             |            |             |       |         |      |       |       |       |           |
| ListPool |  1000 |    925.9 ns |    57.35 ns |   157.0 ns |    850.0 ns |  0.24 |    0.13 |    1 |     - |     - |     - |         - |
|     List |  1000 |  5,455.6 ns | 1,301.86 ns | 3,818.1 ns |  3,600.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |    8024 B |
|          |       |             |             |            |             |       |         |      |       |       |       |           |
| ListPool | 10000 |  3,301.1 ns |   203.66 ns |   557.5 ns |  3,100.0 ns |  0.26 |    0.08 |    1 |     - |     - |     - |         - |
|     List | 10000 | 13,664.4 ns | 1,353.14 ns | 3,772.0 ns | 14,250.0 ns |  1.00 |    0.00 |    2 |     - |     - |     - |   80024 B |
```

## RemoveAt

```
|   Method |     N |       Mean |     Error |     StdDev |     Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |-----------:|----------:|-----------:|-----------:|------:|--------:|-----:|------:|------:|------:|----------:|
| ListPool |    10 |   777.7 ns |  98.09 ns |   279.8 ns |   700.0 ns |  0.90 |    0.60 |    1 |     - |     - |     - |         - |
|     List |    10 | 1,587.4 ns | 534.90 ns | 1,534.7 ns |   800.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
|          |       |            |           |            |            |       |         |      |       |       |       |           |
|     List |   100 |   806.3 ns |  92.05 ns |   264.1 ns |   700.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |   100 |   839.4 ns | 109.18 ns |   311.5 ns |   800.0 ns |  1.12 |    0.47 |    1 |     - |     - |     - |         - |
|          |       |            |           |            |            |       |         |      |       |       |       |           |
| ListPool |  1000 | 1,060.6 ns | 138.23 ns |   394.4 ns |   900.0 ns |  1.35 |    0.87 |    1 |     - |     - |     - |         - |
|     List |  1000 | 1,213.6 ns | 344.49 ns |   948.8 ns |   750.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
|          |       |            |           |            |            |       |         |      |       |       |       |           |
|     List | 10000 | 2,703.6 ns | 362.26 ns |   973.2 ns | 2,300.0 ns |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool | 10000 | 3,007.5 ns | 347.97 ns |   952.6 ns | 2,550.0 ns |  1.20 |    0.49 |    2 |     - |     - |     - |         - |
```

## Remove

```
|   Method |     N |      Mean |     Error |    StdDev |   Median | Ratio | RatioSD | Rank | Gen 0 | Gen 1 | Gen 2 | Allocated |
|--------- |------ |----------:|----------:|----------:|---------:|------:|--------:|-----:|------:|------:|------:|----------:|
|     List |    10 |  1.786 us | 0.2543 us | 0.7296 us | 1.600 us |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |    10 |  2.129 us | 0.4981 us | 1.3884 us | 1.700 us |  1.43 |    1.14 |    1 |     - |     - |     - |         - |
|          |       |           |           |           |          |       |         |      |       |       |       |           |
| ListPool |   100 |  1.312 us | 0.1255 us | 0.3622 us | 1.100 us |  1.01 |    0.37 |    1 |     - |     - |     - |         - |
|     List |   100 |  1.416 us | 0.1789 us | 0.5161 us | 1.100 us |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
|          |       |           |           |           |          |       |         |      |       |       |       |           |
|     List |  1000 |  2.085 us | 0.1422 us | 0.4011 us | 1.900 us |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
| ListPool |  1000 |  2.382 us | 0.2003 us | 0.5842 us | 2.200 us |  1.17 |    0.32 |    2 |     - |     - |     - |         - |
|          |       |           |           |           |          |       |         |      |       |       |       |           |
| ListPool | 10000 | 10.162 us | 0.5594 us | 1.5687 us | 9.600 us |  1.00 |    0.22 |    1 |     - |     - |     - |         - |
|     List | 10000 | 10.458 us | 0.7393 us | 2.0608 us | 9.550 us |  1.00 |    0.00 |    1 |     - |     - |     - |         - |
```